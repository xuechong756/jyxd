var $SF,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n};!function(t){function e(t,e){for(var n=t.toString().length,i=""+t;e>n;)i="0"+i,n++;return i}function n(){return x}function i(){try{return void(x=window.sfplatform?parseInt(window.sfplatform()):window.sfImp?t.ANDROID:window.wx?window.qq?t.QQ:t.WX:window.qq?t.QQ:t.WEB)}catch(t){}return void 0===x&&(x=t.WEB),x}function a(e){switch(n()){case t.ANDROID:Ct=Tt;break;case t.IOS:Ct=Dt;break;default:Ct=Rt}Ct.comInit(e)}function r(t){for(var e,n,i,a="",r=0;r<t.length;)128>(e=t.charCodeAt(r))?(a+=String.fromCharCode(e),r++):e>191&&224>e?(n=t.charCodeAt(r+1),a+=String.fromCharCode((31&e)<<6|63&n),r+=2):(n=t.charCodeAt(r+1),i=t.charCodeAt(r+2),a+=String.fromCharCode((15&e)<<12|(63&n)<<6|63&i),r+=3);return a}function o(t){var e,n,i,a,o,s,c="",u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)e=lt.indexOf(t.charAt(u++))<<2|(a=lt.indexOf(t.charAt(u++)))>>4,n=(15&a)<<4|(o=lt.indexOf(t.charAt(u++)))>>2,i=(3&o)<<6|(s=lt.indexOf(t.charAt(u++))),c+=String.fromCharCode(e),64!=o&&(c+=String.fromCharCode(n)),64!=s&&(c+=String.fromCharCode(i));return r(c)}function s(t){var e=document.createElement("iframe");e.setAttribute("src",t),e.setAttribute("style","display:none;"),e.setAttribute("height","0px"),e.setAttribute("width","0px"),e.setAttribute("frameborder","0"),document.body.appendChild(e),e.parentNode.removeChild(e)}function c(t){return(I+t).replace("-","")}function u(e,i,a){void 0===a&&(a=!0);var r=c(e);return window[r]=function(s){n()==t.IOS&&(s=o(s));var c=s;s&&s.length>256&&(c=s.substr(0,128)+"..."),p(" callbackFN "+e+" data:"+c),i?i(s):p("dummy:"+e),a&&(window[r]=void 0)},r}function d(t,e,n){void 0===n&&(n=!1);var i=c(t);return window[i]=function(t){e?e(t):p("dummy:"+i),n&&(window[i]=void 0)},i}function l(t,e){return window[t]?window[t](e):void 0}function p(i){if(1!=M)switch(n()){case t.IOS:console.log("["+N+"]"+i);break;case t.ANDROID:console.info("["+N+"]"+i);break;default:var a=new Date,r="["+e(a.getHours(),2)+":"+e(a.getMinutes(),2)+":"+e(a.getSeconds(),2)+"."+e(a.getMilliseconds(),3)+"]["+N+"]"+i,o=new Error;if(o.stack)r=r+" "+o.stack.split("\n")[2];console.info(r)}}function f(t,e){Et.onHuTuiShow(t.gid,e),Ct.dispatchMsg(t.gid,pt,t.cbn,e)}function _(t){for(var e=[],n=0,i=0;i<t.length;i++){var a=t.charCodeAt(i);128>a?e[n++]=a:2048>a?(e[n++]=a>>6|192,e[n++]=63&a|128):55296==(64512&a)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(a=65536+((1023&a)<<10)+(1023&t.charCodeAt(++i)),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=63&a|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=63&a|128)}return e}function h(t){for(var e=[],n=0,i=0;n<t.length;){var a=t[n++];if(128>a)e[i++]=String.fromCharCode(a);else if(a>191&&224>a){var r=t[n++];e[i++]=String.fromCharCode((31&a)<<6|63&r)}else if(a>239&&365>a){var o=((7&a)<<18|(63&(r=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(o>>10)),e[i++]=String.fromCharCode(56320+(1023&o))}else{r=t[n++];var s=t[n++];e[i++]=String.fromCharCode((15&a)<<12|(63&r)<<6|63&s)}}return e.join("")}function g(t){for(var e=_(t),n=e.length,i=new ArrayBuffer(n+Ut),a=new Uint8Array(i),r=[],o=0;Ut>o;o++)a[o]=256*Math.random()|0,r.push((255&a[o])+n+(3*o+2)&255);var s=(255&r[0])+(255&r[1]);for(o=0;n>o;o++){var c=o%Ut,u=r[c];u=255&((u=255&(u^Ht[15&o]))<<1|u>>7&1),r[c]=u;var d=s+o+(255&Ht[15&o])+u&7,l=255&(255&e[o]^u);l=l>>d|l<<8-d,a[o+Ut]=l}return i}function m(t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));for(var e=t.length-Ut,n=[],i=0;Ut>i;i++)n.push((255&t[i])+e+(3*i+2)&255);var a=[],r=(255&n[0])+(255&n[1]);for(i=0;e>i;i++){var o=i%Ut,s=n[o];s=255&((s=255&(s^Ht[15&i]))<<1|s>>7&1),n[o]=s;var c=r+i+(255&Ht[15&i])+s&7,u=t[i+Ut];u=255&(u<<c|(255&u)>>8-c),a.push(255&(u^s))}return h(a)}var y="sfgamecenter:",v="S",w="A",S="G";t.WEB=0,t.ANDROID=1,t.IOS=2,t.WX=3,t.QQ=4,t.PROP_PLATFORM="sys.platform",t.PROP_RELEASE="sys.build.release",t.PROP_DEVICE_ID="deviceId",t.PROP_CMD_VIB="cmd.vibration",t.PROP_CMD_CLEARALL="cmd.clearAll",t.PROP_CMD_CLEARDATA="cmd.clearData",t.PROP_PID="pid",t.PROP_UID="uid",t.PROP_TOKEN="token",t.PROP_USER_NAME="nick",t.PROP_USER_ICON_URL="icUrl",t.PROP_MODE="mode",t.PROP_RETRY_CNT="prop.retryCnt";var P="rCnt";t.PROP_CHECK="check";var O,b="enEffect",C="enMusic",A="gc_ver",I="_$CB$",R="loginQQ",D="logoutQQ",T="loginWX",E="logoutWX",k="share";!function(t){t[t.AndroidApp=1]="AndroidApp",t[t.H5App=2]="H5App",t[t.H5Res=3]="H5Res"}(O||(O={}));var M,x,N,B="update",U="restart",H="loadErr",V="appUploadEvent",L="exit",F="onBack",J="onPauseG",G="onResumeG",j="daList",K="daPreload",W="daPlay",q="doDaPlay",Q="doDaStop",X="P_Action",$="P_eAction",z="P_sAction",Y="ga_",Z="gaBack",tt="roundEnd",et="roundStart",nt="g_share",it="resLoad",at="hutuiReq",rt="sfinframemessage",ot="focus",st="app_blur",ct="app_focus",ut="switchview",dt="dispatchmsg",lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",pt=0,ft="margin: auto;width: 100%;height: 100%; overflow-x: hidden; overflow-y: hidden;border:none;position:absolute",_t="https://testfsbn.snowfish.cn:8312",ht="https://hutui.appgames.cn:8308",gt="/hutui/mat/req/",mt="/hutui/mat/hts/",yt="postHomeMsg",vt={},wt=function(){function t(){}return t.isSupport=function(){var t=Ct.prop("issupport");return(void 0===t||null===t)&&(t="{}"),t},t.loginQQ=function(t){Ct.invoke(v,R,[u(R,t,!0)])},t.logoutQQ=function(t){Ct.invoke(v,D,[u(D,t,!0)])},t.loginWX=function(t){Ct.invoke(v,T,[u(T,t,!0)])},t.logoutWX=function(t){Ct.invoke(v,E,[u(E,t,!0)])},t.share=function(t,e){Ct.invoke(v,k,[u(k,e,!0),t])},t.joinQQGroup=function(t,e){Ct.invoke(v,"joinQQGroup",[t,e])},t}();t.SFSocial=wt,__reflect(wt.prototype,"$SF.SFSocial");var St=function(){function t(){}return t.action=function(e,n){Ct.invoke("P",X,[u(X+e.productId,function(e){var i=JSON.parse(e);if(n){var a=void 0;switch(i.r){case"ok":a=t.OK;break;case"cancel":a=t.Cancel;break;default:a=t.Fail}n(a,i.orderId,i.productId,i.msg)}return!0},!0),e.productId,e.price,e.productName,e.orderId])},t.finishAction=function(t,e){Ct.invoke("P",$,[u($+t.productId,e,!0),t.productId,t.orderId])},t.onResumeAction=function(e){u("P_rAction",function(n){var i=JSON.parse(n);if(e){var a=void 0;switch(i.r){case"ok":a=t.OK;break;case"cancel":a=t.Cancel;break;default:a=t.Fail}e(a,i.orderId,i.productId,i.msg)}return!0},!1)},t.restoreAction=function(t){Ct.invoke("P",z,[u(z,t,!0)])},t.OK=0,t.Fail=1,t.Cancel=2,t}();t.SFPay=St,__reflect(St.prototype,"$SF.SFPay");var Pt=[],Ot=[],bt=function(){function e(){}return e._frameName=function(t){return t==pt?"main_view":"sf_sub_iframe"+t},e._loadURLInFrame=function(t,n,i,a){p("subUrl:"+n+" url:"+t);var r=parent.document.createElement("iframe");r.setAttribute("id",e._frameName(n)),r.setAttribute("src",t),r.setAttribute("style",ft),parent.document.body.appendChild(r),a&&(r.onload=function(){a(!0)},r.onerror=function(t){a(!1),p("_loadURLInFrame onerror:"+t)}),Ot.push(n)},e._postMsg=function(t,n,i){if(t==n){p("skip _postMsg [self:"+n+"]:"+JSON.stringify(i));var a=rt+JSON.stringify(i);e._onEngine(a)}else if(t==pt){a=rt+JSON.stringify(i);p("_postMsg ["+n+"-> 0(app)]:"+JSON.stringify(i)),window.parent.postMessage(a,"*")}else{var r=parent.document.getElementById(e._frameName(t));if(r){p("_postMsg ["+n+"->"+t+"(game)]:"+JSON.stringify(i));a=rt+JSON.stringify(i);r.contentWindow.postMessage(a,r.src)}else p("dummy iframe")}},e._cmdSwitch=function(t){var n=document.getElementById(e._frameName(t.gid));if(n){var i=parent.document.getElementById(e._frameName(t.target_gameId));i?(2===t.mode?(t.target_gameId!=pt&&i.setAttribute("style",ft),i.style.zIndex="2",n.style.zIndex="1"):n.style.display="none",i.style.display="block",Pt.push(t.target_gameId),p("_cmdSwitch "+t.gid+"<->"+t.target_gameId+" showIframe.contentWindow == window?"+(i.contentWindow==window)),t.target_gameId>0?(p("[focus] try game focus in _cmdSwitch"),e._postMsg(t.target_gameId,t.gid,{cmd:ot})):(p("[focus] try app focus in _cmdSwitch"),e._postMsg(0,t.gid,{cmd:ot}))):p("_cmdSwitch err2:"+JSON.stringify(t))}else p("_cmdSwitch err1:"+JSON.stringify(t))},e._closeclose=function(t,n,i){p("_closeclose hideGameId:"+t+" showGameId:"+n+" rm:"+i);var a=document.getElementById(e._frameName(t));a&&(a.style.zIndex="0",a.style.display="none",i&&t!=pt&&parent.document.body.removeChild(a));var r=parent.document.getElementById(e._frameName(n));r&&(a.style.zIndex="0",r.style.display="block",n>0?(p("[focus] try game focus in _closeclose"),e._postMsg(n,t,{cmd:ot})):(p("[focus] try app focus in _closeclose"),e._postMsg(0,t,{cmd:ot}),window[c(Z)]&&window[c(Z)](t)))},e._cmdClose=function(){if(p("_cmdClose _luanchView.length: "+Ot.length+" _switchView.length:"+Pt.length),1!==Ot.length)if(0!==Pt.length){var t=Pt.pop();Pt.length>0?(n=Pt[Pt.length-1],e._closeclose(t,n,!1)):(n=Ot[Ot.length-1],e._closeclose(t,n,!0))}else{t=Ot.pop();var n=Ot[Ot.length-1];e._closeclose(t,n,!0)}},e._cmdDispatchMsg=function(t){if(t.cbn&&window[t.cbn])window[t.cbn](t.d);else if(t.gid>0)for(var e in p("!! _cmdDispatchMsg no callback:"+t.cbn),window)e.substr(0,5)==I&&p("dump method:"+e)},e._onEngine=function(t){if(p("_recv msg:"+t),new RegExp(rt).test(t)){var n=t.slice(rt.length,t.length),i=JSON.parse(n);switch(i.cmd){case ut:e._cmdSwitch(i);break;case"back":e._cmdClose();break;case dt:e._cmdDispatchMsg(i);break;case ot:p("on CMD_FOCUS"),window.focus();break;case"blur":p("on CMD_BLUR"),window.blur();break;case st:p("on CMD_APP_PAUSE"),window[c(J)]&&window[c(J)](),window.blur();break;case ct:p("on CMD_APP_RESUME"),window[c(G)]&&window[c(G)](),window.focus()}}},e.registerEventListener=function(){window.addEventListener("message",function(t){void 0!==t.data&&e._onEngine(t.data)},!1)},e.launchH5=function(t){if(0===Pt.length){for(var n=0;n<Ot.length;n++)if(Ot[n]===t.gid)return void p("error same id");var i;if(!t.isBgLaunch)if(0!=Ot.length&&(i=Ot[Ot.length-1]),i){var a=document.getElementById(e._frameName(i));a&&(a.style.display="none")}e._loadURLInFrame(t.url,t.gid,t.isBgLaunch,t.htmlCB),t.isBgLaunch&&e._cmdSwitch({target_gameId:pt,gid:t.gid,mode:2})}else p("!! skip launchH5 _switchView.length:"+Pt.length)},e.dispatchMsgH5=function(t,n,i){e._postMsg(t,N,{cmd:dt,gid:N,cbn:n,d:i})},e.switchViewH5=function(t,n,i,a){t!==n&&e._postMsg(pt,N,{cmd:ut,target_gameId:t,gid:n,mode:i,exparams:a})},e.backH5=function(){e._postMsg(pt,N,{cmd:"back"})},e._genSubViewId=function(t){var e="sf_sub_view";return void 0!==t&&null!==t&&(e+=t),e},e.addSubView=function(n,i,a,r,o,s,c){var u=e._genSubViewId(c),d=document.getElementById(u);if(void 0===d||null===d){var l=document.createElement("div");l.setAttribute("id","if_div");var p="-webkit-overflow-scrolling: touch;position:absolute;border:none";p+=Ct.prop(t.PROP_PLATFORM)==t.IOS?";overflow:scroll":";overflow:hidden",p+=";width:"+r+"px",p+=";height:"+o+"px",l.setAttribute("style",p),l.style.top=i+"px",l.style.left=a+"px",document.body.appendChild(l),(d=document.createElement("iframe")).setAttribute("id",e._genSubViewId(c)),d.setAttribute("src",n);var f="border:none";f+=";-webkit-overflow-scrolling: touch;width:100%;height:100%",d.setAttribute("style",f),l.appendChild(d),d.onload=s}else{d.setAttribute("src",n);f="border:none";f+=";-webkit-overflow-scrolling: touch;width:100%;height:100%",d.setAttribute("style",f),void 0!==s&&null!==s&&s()}},e.removeSubView=function(t){var n=e._genSubViewId(t);if(document.getElementById(n)){var i=document.getElementById("if_div");document.body.removeChild(i)}},e.topID=function(){return Pt.length>0?Pt[Pt.length-1]:Ot.length>0?Ot[Ot.length-1]:void 0},e.pause=function(t){var n=t||e.topID();e._postMsg(n,N,{cmd:st})},e.resume=function(t){var n=t||e.topID();e._postMsg(n,N,{cmd:ct})},e.forceClose=function(t){if(At++,1!=Ot.length){if(N!=pt)return void p("!! no permission clearAll");for(;0!=Pt.length;){var n=Pt.pop();Pt.length>0?(i=Pt[Pt.length-1],e._closeclose(n,i,!1)):(i=Ot[Ot.length-1],e._closeclose(n,i,!0))}for(;Ot.length>=2;){n=Ot.pop();var i=Ot[Ot.length-1];e._closeclose(n,i,!0)}}},e}();__reflect(bt.prototype,"SFH5Support");var Ct,At=0,It=function(){function t(){}return t.comInit=function(t){bt.registerEventListener(),t.complete&&t.complete()},t.dispatchMsg=function(t,e,n,i){bt.dispatchMsgH5(t,n,i)},t.switchView=function(t,e,n,i){bt.switchViewH5(t,e,n,i)},t.launchTimeOut=function(){At++},t.back=function(){bt.backH5()},t.addSubView=function(t,e,n,i,a,r,o){bt.addSubView(t,e,n,i,a,r,o)},t.removeSubView=function(t){bt.removeSubView(t)},t.pause=function(t){bt.pause(t)},t.resume=function(t){bt.resume(t)},t.forceClose=function(t){bt.forceClose(t)},t.loadErr=function(t){t.flag?Ct.invoke(S,H,[u(H,t.cb,!0),t.msg,t.flag]):Ct.invoke(S,H,[u(H,t.cb,!0),t.msg])},t.appUploadEvent=function(t){Ct.invoke(S,V,[u(V,t.cb,!1),t.url,t.eventData])},t.exit=function(){Ct.invoke(S,L)},t.share=function(t,e){Ct.invoke(v,k,[u(k,e),t])},t}();__reflect(It.prototype,"comBase");var Rt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.getKey=function(t){27==((t=t||window.event).which?t.which:t.keyCode)&&window[c(F)]&&window[c(F)]()},n.comInit=function(i){e.comInit.call(this,i),document.addEventListener?document.addEventListener("keyup",n.getKey,!1):document.attachEvent?document.attachEvent("onkeyup",n.getKey):document.onkeyup=n.getKey,i.id>0&&(window[c(F)]=function(t){bt.dispatchMsgH5(0,c(F))});var a=window.localStorage.getItem(t.PROP_DEVICE_ID);a&&0!=a.length||(a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}),window.localStorage.setItem(t.PROP_DEVICE_ID,a))},n.prop=function(e,n){if(void 0===n){if(!(n=window.localStorage.getItem(e)))switch(e){case t.PROP_RELEASE:return"0";case t.PROP_PLATFORM:return t.WEB;case j:return JSON.stringify([1,6,7,8]);case"sys.verName":case"sys.build.osVer":return"web_1.0";case"sys.verCode":return"2";case"sys.pkgName":return"com.sf.new.flat.ios";case"sys.channel":return"snowfish";case"sys.build.model":return"pc";case"issupport":return JSON.stringify({login:["wx","qq"]})}return n}switch(e){case t.PROP_CMD_CLEARDATA:window.localStorage.clear();break;default:null===n||""===n?window.localStorage.removeItem(e):window.localStorage.setItem(e,n)}},n.launch=function(t,e){var n=At;setTimeout(function(){return At!=n?void p("pplistener skip "+At):(At++,t.shellCB&&t.shellCB(!0),void(e||bt.launchH5({url:t.zipUrl.replace(".zip","/")+t.search,gid:t.gid,isBgLaunch:t.isBgLaunch,htmlCB:t.htmlCB})))},100)},n.invoke=function(t,e,i){switch(e){case K:setTimeout(function(){l(i[0],Kt.STATUS_OK)},100);break;case W:n._tmpCnt++;for(var a=n._tmpCnt;a-- >0;)l(i[0],Kt.STATUS_CLICK_AD);n._tmpCnt%2?(p("simulate daPlay success"),setTimeout(function(){l(i[0],Kt.STATUS_OK)},3e3)):(p("simulate daPlay fail"),setTimeout(function(){l(i[0],Kt.STATUS_OUT_OF_AD)},1e3));break;case X:n._tmpCnt++,n._tmpCnt%2?(p("simulate daPlay success"),setTimeout(function(){l(i[0],JSON.stringify({r:"ok",msg:"simulate success"}))},3e3)):(p("simulate daPlay fail"),setTimeout(function(){l(i[0],JSON.stringify({r:"fail",msg:"simulate fail"}))},1e3));break;case k:n._tmpCnt++,n._tmpCnt%2?(p("simulate share success"),l(i[0],JSON.stringify({r:"ok"}))):(p("simulate share fail"),l(i[0],JSON.stringify({r:"fail"})));break;case B:setTimeout(function(){l(i[0],JSON.stringify({r:"ok"}))},5e3);break;case U:window.location.replace(i[2]);break;case L:window.location.reload();break;case H:break;default:switch(t){case w:break;default:i&&i[0]&&(p("! not support:"+t+" "+e+" arg:"+JSON.stringify(i)),l(i[0],JSON.stringify({r:"fail",msg:"not support!"})))}}},n.hutuiAct=function(t){},n._tmpCnt=0,n}(It);__reflect(Rt.prototype,"comH5");var Dt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prop=function(e,n){if(e==t.PROP_PLATFORM)return""+t.IOS;if(void 0===n){var i=prompt(y+e,"");return i&&""!==i&&"$sf$removeItem"!=i?i:null}return null===n||""===n?(prompt(y+e,"$sf$removeItem"),null):(prompt(y+e,n),n)},n.launch=function(t,e){var i=At;n.invoke(S,"launch",[t.zipUrl,u("pplistener",function(n){if(At!=i)p("pplistener skip "+i+"vs"+At+" "+n);else{p("pplistener "+n),At++;var a=!!n,r={url:n+t.search,gid:t.gid,isBgLaunch:t.isBgLaunch,htmlCB:t.htmlCB};t.shellCB&&t.shellCB(a),e||bt.launchH5(r)}},!0),t.zipVer,t.gid])},n.invoke=function(t,e,n){var i={functionName:t+e,arguments:n},a=JSON.stringify(i);s(y+a)},n.hutuiAct=function(t){xt.onEvent("hutuiAct"),4===t.type?Bt.getJSON(t.src,function(t,e,i){e&&n.invoke(S,"hutuiAct",[e.link])}):(5===t.type||6===t.type)&&n.invoke(S,"hutuiAct",[t.src])},n}(It);__reflect(Dt.prototype,"comIOS");var Tt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.prop=function(e,n){if(e==t.PROP_PLATFORM)return""+t.ANDROID;if(void 0===n){var i=window.sfImp.getProperty(e);return i&&""!==i?i:null}null===n||""===n?window.sfImp.setProperty(e,""):window.sfImp.setProperty(e,n)},n.launch=function(t,e){var i=At;n.invoke(S,"launch",[t.zipUrl,u("pplistener",function(n){if(At!=i)p("pplistener skip "+i+"vs"+At+" "+n);else{p("pplistener "+n),At++;var a=JSON.parse(n),r=!!a.url,o={url:a.url+t.search,gid:t.gid,isBgLaunch:t.isBgLaunch,htmlCB:t.htmlCB};t.shellCB&&t.shellCB(r),e||bt.launchH5(o)}},!0),t.zipVer,t.gid])},n.invoke=function(t,e,n){var i={functionName:t+e,arguments:n},a=JSON.stringify(i);s(y+a)},n.hutuiAct=function(t){xt.onEvent("hutuiAct"),n.invoke(S,"hutuiAct",[t])},n}(It);__reflect(Tt.prototype,"comAndr"),t.log=p;var Et=function(){function e(){}return e.init=function(r){Ot[0]=pt,N=r.id,e._id=r.id,i(),a(r),(null===(M=Ct.prop(t.PROP_RELEASE))||""==M)&&(M=1),window[c("onPause")]=function(t){Ct.pause(),window[c(J)]&&window[c(J)]()},window[c("onResume")]=function(t){Ct.resume(),window[c(G)]&&window[c(G)]()},window[c(at)]=function(i){var a=e.prop(t.PROP_UID)?e.prop(t.PROP_UID):"",r=""+i.gid;if(p("hutui data.cnt"+i.cnt),0!=i.cnt&&vt[r])f(i,vt[r]);else{var o=("1"==Ct.prop("ga_url_type")?_t:ht)+gt;Bt.postJSONEx(o,!1,{poss:i.data,gId:r,uId:a,pId:n(),channel:e.prop("sys.channel")},function(t,e,n){vt[r]=e,f(i,vt[r])})}}},e.back=function(){Ct.back()},e.prop=function(e,n){return e==t.PROP_RELEASE&&void 0!==n&&(M=n),Ct.prop(e,n)},e.onBack=function(t){u(F,t,!1)},e.launch=function(e){e.search?e.search+="&"+t.PROP_PID+"="+n():e.search+="?"+t.PROP_PID+"="+n(),Ct.launch(e)},e.preLaunch=function(t){Ct.launch(t,!0)},e.launchTO=function(){Ct.launchTimeOut()},e.addView=function(t){Ct.addSubView(t.url,t.top,t.left,t.w,t.h,t.onload,t.viewId)},e.removeView=function(t){Ct.removeSubView(t.viewId)},e.onPause=function(t){d(J,t)},e.onResume=function(t){d(G,t)},e.isBackGround=function(){return"none"==document.getElementById("main_view").style.display},e.onComRsp=function(t){Ct.dispatchMsg(t.gid,e._id,t.cbn,t)},e.onGameBack=function(t){d(Z,t)},e.onGameStartReq=function(t){d(et,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)})},e.onGameStartRsp=function(t){e.onComRsp(t)},e.onGameEndReq=function(t){d(tt,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)})},e.onGameEndRsp=function(t){e.onComRsp(t)},e.onGameMsgReq=function(t){d(yt,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)})},e.onGameMsgRsp=function(t){e.onComRsp(t)},e.onGameLoading=function(t){d(it,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)})},Object.defineProperty(e,"daUserToken",{get:function(){return Wt.userToken},enumerable:!0,configurable:!0}),e.daInit=function(t){return Wt.initing?void(t&&t(qt.BusyInit)):Wt.inited?void(t&&t(qt.Success)):void Wt.init(function(e){t&&t(e?qt.Success:qt.InitFail)})},e.daPlay=function(t,e,n){Wt.play(t,e,n)},e.daHideBa=function(){Wt.hideBa()},e.onDAReq=function(t){d(q,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)}),d(Q,function(){Wt.hideBa()})},e.onDARsp=function(t){e.onComRsp(t)},e.loginQQ=function(t){wt.loginQQ(t)},e.loginWX=function(t){wt.loginWX(t)},e.joinQQGroup=function(t){wt.joinQQGroup(t.uin,t.key)},e.onGameShareReq=function(t){d(nt,function(n){e._gameVerifyCB&&e._gameVerifyCB(n.gid),t&&t(n)})},e.onGameShareRsp=function(t){e.onComRsp(t),e.back()},e.startShare=function(t,e){Ct.share(t,e)},e.exitApp=function(){Ct.exit()},e.update=function(t,e){Ct.invoke(S,B,[u(B,e,!1),t.type,t.gid,t.url,t.ver])},e.restart=function(t){Ct.invoke(S,U,[t.type,t.gid,t.url,t.ver])},e.resumeApp=function(){var n=Pt.length>0?Pt[Pt.length-1]:Ot[Ot.length-1];return n==e._id?(t.log("!! app is Top"),!1):(Ct.switchView(e._id,n,2,""),!0)},e.resumeGame=function(){Pt.length>0&&Pt[Pt.length-1]==e._id?e.back():t.log("!! no game paused")},e.forceClose=function(t){Ct.forceClose(t)},e.onHuTuiReq=function(i){d("hutui",function(a){e._gameVerifyCB&&e._gameVerifyCB(a.gid);var r=("1"==Ct.prop("ga_url_type")?_t:ht)+mt,o=e.prop(t.PROP_UID);Bt.postJSONEx(r,!1,{gId:""+a.gid,pId:n(),userId:o||"",type:1,cbData:a.data.cbData}),i&&i(a)})},e.doHutuiAct=function(t){Ct.hutuiAct(t)},e.onNormalFrame=function(t){d("onNormalFrame",t)},e.onLoadingErr=function(t){Ct.loadErr(t)},e.onAppUploadEvent=function(t){Ct.appUploadEvent(t)},e.onHuTuiShow=function(n,i){if(i){p("--onHuTuiShow ="+JSON.stringify(i));for(var a=[],r=e.prop(t.PROP_UID),o=0,s=i.rensponse;o<s.length;o++){var c=s[o];p("--HuTuidata.cbData ="+JSON.stringify(c.data.cbData)),a.push({gId:""+n,pId:x,userId:r||"",type:0,cbData:c.data.cbData})}var u=("1"==Ct.prop("ga_url_type")?_t:ht)+"/hutui/mat/htslist/";Bt.postJSONEx(u,!1,{list:a},function(t,e,n){p("HuTuidata.show ="+JSON.stringify(e))})}},e.onGameVerify=function(t){e._gameVerifyCB=t},e}();t.App=Et,__reflect(Et.prototype,"$SF.App");var kt=function(){function e(){}return e.remapKey=function(e){return"sf#"+Mt.prop(t.PROP_UID)+"#"+Mt.id+"#"+e},e.setItem=function(t,e){Ct.prop(this.remapKey(t),e)},e.getItem=function(t){var e=Ct.prop(this.remapKey(t));return void 0===e||"string"==typeof e&&0==e.length?null:e},e.removeItem=function(t){Ct.prop(this.remapKey(t),null)},e.clear=function(){Ct.prop(t.PROP_CMD_CLEARDATA,!0)},e.getJSON=function(t){try{return JSON.parse(this.getItem(t))}catch(t){return}},e.setJSON=function(t,e){e?this.setItem(t,JSON.stringify(e)):this.removeItem(t)},e}();t.sfLocalStorage=kt,__reflect(kt.prototype,"$SF.sfLocalStorage");var Mt=function(){function e(){}return e.getUrlParam=function(n){if(!e._requestParams[n])switch(n){case t.PROP_MODE:return"0";case t.PROP_CHECK:return"NO";case P:return"2";case b:case C:return"true";case A:return Ct.prop(A)}return e._requestParams[n]},e.setUrlParam=function(t,n){e._requestParams[t]=decodeURI(n)},e.initParams=function(t){if(-1!=t.indexOf("?"))for(var n=t.substr(1).split("&"),i=0;i<n.length;i++){var a=n[i].split("=")[0],r=n[i].substr(a.length+1);e.setUrlParam(a,r)}},e.initPId=function(){return e.getUrlParam(t.PROP_PID)?x=parseInt(e.getUrlParam(t.PROP_PID)):i(),x},e.init=function(n){e._id=n.id,e._isFirstStart=!0,Ot[0]=pt,N=n.id,e.initParams(window.location.search),e.initPId(),e._isSingle=window==window.parent&&x!=t.WX,a(n),null===(M=Ct.prop(t.PROP_RELEASE))&&(M=1),e.daInit(function(t){p("init da:"+t)})},e.id=function(){return e._id},Object.defineProperty(e,"isSingle",{get:function(){return e._isSingle},enumerable:!0,configurable:!0}),e.back=function(t){Ct.back()},e.prop=function(i,a){switch(i){case t.PROP_TOKEN:case t.PROP_UID:case t.PROP_USER_NAME:case t.PROP_USER_ICON_URL:case t.PROP_MODE:case t.PROP_CHECK:case b:case C:case A:return e.getUrlParam(i);case t.PROP_RETRY_CNT:return e.getUrlParam(P);case t.PROP_PLATFORM:return n()}return i==t.PROP_RELEASE&&void 0!==a&&(M=a),Ct.prop(i,a)},e.startVib=function(e){return Ct.prop(t.PROP_CMD_VIB,e||20)},e.onLoadingProgress=function(t){e._isSingle||Ct.dispatchMsg(pt,e._id,c(it),{gid:e._id,loadCur:t.loadCur,loadMax:t.loadMax,mode:e.mode()})},e.onGameStart=function(t,n){if(e._isSingle)t({r:!0});else{Ct.dispatchMsg(pt,e._id,c(et),{gid:e._id,first:e._isFirstStart,mode:e.mode(),params:n||null,cbn:d(Y+et,function(n){p("[focus] try game focus in onGameStart"),Ct.resume(e._id),t&&t(n)})})}e._isFirstStart=!1},e.onGameEnd=function(t,n){if(e._isSingle)n({r:!0});else{Ct.dispatchMsg(pt,e._id,c(tt),{gid:e._id,sc:t.score,win:t.win,fps:t.fps,mode:e.mode(),roomMode:t.rmode?t.rmode:0,param:t,cbn:d(Y+tt,function(t){p("[focus] try game focus in onGameEnd"),Ct.resume(e._id),n&&n(t)})})}},e.mode=function(){return parseInt(e.getUrlParam(t.PROP_MODE))},e.startShare=function(t,n){if(e._isSingle)n({r:!1});else{Ct.switchView(pt,e._id,2,""),Ct.dispatchMsg(pt,e._id,c(nt),{gid:e._id,cbn:d(Y+nt,function(t){p("[focus] try game focus in startShare"),Ct.resume(e._id),n&&n(t)})})}},e.hutuiReq=function(i,a){if(e.prop(A)){Ct.dispatchMsg(pt,e._id,c(at),{cnt:e._hutuiReqCnt++,data:i,gid:e._id,cbn:d(Y+at,function(t){p("onGetHutui data"+JSON.stringify(t)),a&&a(t)})})}else{var r=e.prop(t.PROP_UID),o={poss:i,gId:""+e._id,uId:r||"",pId:n(),channel:""},s=("1"==Ct.prop("ga_url_type")?_t:ht)+gt;Bt.postJSONEx(s,!1,o,a)}},e.hutuiAct=function(i){if(e._isSingle){var a=("1"==Ct.prop("ga_url_type")?_t:ht)+mt,r=e.prop(t.PROP_UID);Bt.postJSONEx(a,!1,{gId:""+e._id,pId:n(),userId:r||"",type:1,cbData:i.cbData}),Ct.hutuiAct(i)}else Ct.dispatchMsg(pt,e._id,c("hutui"),{data:i,gid:e._id})},e.onPause=function(t){d(J,t)},e.onResume=function(t){d(G,t)},e.postHomeMsg=function(t,n,i){if(e._isSingle)i({r:"FAIL"});else{Ct.dispatchMsg(pt,e._id,c(yt),{gid:e._id,msgId:t,msgD:n,cbn:d(Y+yt+t,function(t){p("[focus] try game focus in onGetParam"),t&&!t.inBackFlag&&Ct.resume(e._id),i&&i(t.extra)})})}},Object.defineProperty(e,"daUserToken",{get:function(){return Wt.userToken},enumerable:!0,configurable:!0}),e.daInit=function(t){if(e._isSingle){if(Wt.initing)return void(t&&t(qt.BusyInit));if(Wt.inited)return void(t&&t(qt.Success));Wt.init(function(e){t&&t(e?qt.Success:qt.InitFail)})}else t&&t(qt.Success)},e._postPlayDa=function(t,n,i){Ct.dispatchMsg(pt,e._id,c(q),{gid:e._id,p:t,up:n,cbn:d(""+t,function(t){Ct.resume(e._id),i&&i(t.r)})})},e.playFullVideo=function(t,n,i){var a=this;void 0===i&&(i=!1),e._isSingle?Wt.inited?Wt.play(i?Qt.FullVideoLandscape:Qt.FullVideoPortrait,t,function(t){n(t.s)}):Wt.init(function(e){e?a.playFullVideo(t,n,i):n(qt.InitFail)}):this._postPlayDa(i?Qt.FullVideoLandscape:Qt.FullVideoPortrait,t,n)},e.playRewardVideo=function(t,n,i){var a=this;void 0===i&&(i=!1),e._isSingle?Wt.inited?Wt.play(i?Qt.RewardVideoLandscape:Qt.RewardVideoPortrait,t,function(t){n(t.s)}):Wt.init(function(e){e?a.playRewardVideo(t,n,i):n(qt.InitFail)}):this._postPlayDa(i?Qt.RewardVideoLandscape:Qt.RewardVideoPortrait,t,n)},e.showBa=function(t,n,i){var a=this;e._isSingle?Wt.inited?Wt.play(n?Qt.BaTop:Qt.BaBottom,t,function(t){i&&i(t.s)}):Wt.init(function(e){e?a.showBa(t,n,i):i(qt.InitFail)}):this._postPlayDa(n?Qt.BaTop:Qt.BaBottom,t,i)},e.hideBa=function(){e._isSingle?Wt.hideBa():Ct.dispatchMsg(pt,e._id,c(Q),{gId:e._id})},e._hutuiReqCnt=0,e._isFirstStart=!0,e._requestParams={},e.localStorage=kt,e}();t.Ga=Mt,__reflect(Mt.prototype,"$SF.Ga");var xt=function(){function t(){}return t.onEvent=function(t){Ct.invoke(w,"onEvent",[t])},t.onEventWithParameters=function(t,e){Ct.invoke(w,"onEventWithParameters",[t,e])},t.trackingRegisterUid=function(t){Ct.invoke(w,"trackingRegisterUid",[t])},t.trackingLoginUid=function(t){Ct.invoke(w,"trackingLoginUid",[t])},t.trackingonEvent=function(t){Ct.invoke(w,"trackingonEvent",[t])},t.trackingDAEvent=function(t,e,n,i){Ct.invoke(w,"trackingDAEvent",[t,e,n,i])},t}();t.Analytics=xt,__reflect(xt.prototype,"$SF.Analytics");var Nt=function(){function t(){}return t._createXHR=function(){return new XMLHttpRequest},t._defaultAjaxSuccessHandler=function(){},t._defaultAjaxErrorHandler=function(){},t._defaultAjaxCompleteHandler=function(){},t._xhrJsonHandler=function(t){return JSON.parse(t._xhr.responseText)},t._xhrJsonJFBHandler=function(t){return JSON.parse(m(t._xhr.response))},t._xhrXmlHandler=function(t){return t._xhr.responseXML},t._xhrHtmlHandler=function(t){return t._xhr.responseText},t._xhrJsonPHandler=function(t){},t._xhrTextHandler=function(t){return t._xhr.responseText},t._xhrNoneHandler=function(t){return null},t._ajaxDataFilter=function(t){return t},t.prototype.start=function(){var t=this,e=t._xhr;if(t.hasDone=!1,t.username?e.open(t.type,t.url,t.async,t.username,t.password):e.open(t.type,t.url,t.async),t.mimeType&&e.overrideMimeType(t.mimeType),t.data&&t.contentType&&e.setRequestHeader("Content-Type",t.contentType),t.ifModified&&e.setRequestHeader("If-Modified-Since",t.ifModified),"xml"==t.dataType?e.responseType="document":("jfb"==t.dataType||"arraybuffer"==t.dataType)&&(e.responseType="arraybuffer"),t.accepts&&t.accepts.length>0){for(var n="",i=0;i<t.accepts.length;i++)i>0&&(n+=", "),n+=t.accepts[i];e.setRequestHeader("Accept",n)}if(t.headers)for(var a in t.headers)void 0!==a&&t.headers.hasOwnProperty(a)&&void 0!==t.headers[a]&&e.setRequestHeader(a,t.headers[a]);var r=void 0;t.timeout&&t.timeout>0&&(r=setTimeout(function(){clearTimeout(r),t.hasDone=!0,e.abort(),t.error(t,"timeout"),t.complete(t,"timeout")},t.timeout)),e.onreadystatechange=function(){if(4!=e.readyState||t.hasDone)3==e.readyState&&t.partial&&t.partial(e.responseText,"partial");else{t.hasDone=!0,void 0!==r&&clearTimeout(r);var n=t._xhrMapHttpStatus(t._xhr);if((""==e.responseType||"text"==e.responseType)&&null==e.responseText||0==e.status)t.error(t,n,"");else{var i=t.statusCode[e.status];if(i)i(t,n);else if(200==e.status||206==e.status||t.ifModified&&304==e.status){var a=!1;try{304!=e.status&&(t.partial&&t.partial(e.responseText,"done"),t.resultData=t.resultHandler(t))}catch(e){a=!0,t.error(t,n,e)}a||t.success(t.dataFilter(t.resultData,t),n,t)}else t.error(t,n,e.statusText)}t.complete(t,n)}};try{t.data?e.send(t.data):e.send()}catch(e){t.hasDone=!0,t.error(t,"error",e.toString()),t.complete(t,"error")}},t.prototype.abort=function(){var t=this;t.hasDone||!t._xhr||2!=t._xhr.readyState&&3!=t._xhr.readyState||(t.hasDone=!0,t._xhr.abort(),t.error(t,"abort"),t.complete(t,"abort"))},t.prototype.done=function(t){return this.success=t,this},t.prototype.fail=function(t){return this.error=t,this},t.prototype.always=function(t){return this.complete=t,this},t.prototype._xhrMapHttpStatus=function(t){if((""==t.responseType||"text"==t.responseType)&&null==t.responseText||0==t.status)return"error";var e=t.status;return 200==e||206==e?"success":304==e?"notmodified":"error"},t}();__reflect(Nt.prototype,"FWXHR");var Bt=function(){function t(){}return t.ajax=function(t,e){var n=new Nt;return n.url=t,n.type=e.type||"GET",n.async=void 0===e.async||e.async,n.dataType=e.dataType||"html",n.contentType=e.contentType||"application/x-www-form-urlencoded; charset=UTF-8",n.data=e.data,n.password=e.password||void 0,n.username=e.username||void 0,n.statusCode=e.statusCode||{},n.timeout=e.timeout||void 0,n.cache=e.cache||!1,n.accepts=e.accepts||[],n.headers=e.headers||{},n.mimeType=e.mimeType,n.success=e.success||Nt._defaultAjaxSuccessHandler,n.error=e.error||Nt._defaultAjaxErrorHandler,n.complete=e.complete||Nt._defaultAjaxCompleteHandler,n.ifModified=e.ifModified,n.dataFilter=e.dataFilter||Nt._ajaxDataFilter,n.partial=e.partial||void 0,e.resultHandler?n.resultHandler=e.resultHandler:"html"==n.dataType?n.resultHandler=Nt._xhrHtmlHandler:"xml"==n.dataType?n.resultHandler=Nt._xhrXmlHandler:"json"==n.dataType?n.resultHandler=Nt._xhrJsonHandler:"text"==n.dataType?n.resultHandler=Nt._xhrTextHandler:"jfb"==n.dataType&&(n.resultHandler=Nt._xhrJsonJFBHandler),n.resultHandler=n.resultHandler||Nt._xhrNoneHandler,n.jsonp||(n._xhr=Nt._createXHR()),(void 0===e.start||1==e.start)&&n.start(),n},t.getJSON=function(e,n,i,a){var r=Date.now(),o={type:"GET",async:!0,success:function(t,e,i){n&&n(i,t,Date.now()-r)},error:function(t,e){n&&n(t,void 0,Date.now()-r)},timeout:i||15e3,headers:a};t.ajax(e,o)},t.postJSONEx=function(e,n,i,a,r,o){var s=Date.now(),c={type:"POST",async:!0,success:function(t,e,n){a&&a(n,t,Date.now()-s)},error:function(t,e){a&&a(t,void 0,Date.now()-s)},timeout:r||15e3,headers:o};c.data=i,n?(c.data=g(i),c.dataType="jfb",c.accepts=["application/vnd+sf+jfb"],c.contentType="application/vnd+sf+jfb"):(c.data=i,c.dataType="json",c.contentType="application/json; charset=UTF-8"),t.ajax(e,c)},t}();t.XMLHttp=Bt,__reflect(Bt.prototype,"$SF.XMLHttp");var Ut=8,Ht=[172,167,71,90,56,85,105,170,34,175,243,95,129,101,237,241],Vt="prop.da.config",Lt="prop.da.uToken",Ft={},Jt=function(){function t(){}return t.MODE_COUNT=1,t.MODE_WEIGHT=2,t.Banner=2,t.RewardVideo=5,t.RewardVideoLandscape=8,t.FullVideo=6,t.FullVideoLandscape=9,t}();__reflect(Jt.prototype,"AdCode");var Gt=function(){return function(){}}();__reflect(Gt.prototype,"AdPointConf");var jt=function(){return function(){}}();__reflect(jt.prototype,"AdSdkPolicy");var Kt=function(){function t(){}return t.STATUS_UNKNOWN=0,t.STATUS_PROMPTED=1,t.STATUS_OK=2,t.STATUS_CANCELED=3,t.STATUS_OUT_OF_AD=4,t.STATUS_TIMEOUT=5,t.STATUS_CLICK_AD=6,t}();t.AdShowInfo=Kt,__reflect(Kt.prototype,"$SF.AdShowInfo");var Wt=function(){function e(){}return Object.defineProperty(e,"initing",{get:function(){return this._initing},enumerable:!0,configurable:!0}),Object.defineProperty(e,"inited",{get:function(){return this._inited},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userToken",{get:function(){return t.Ga.prop(Lt)},set:function(e){t.Ga.prop(Lt,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cfgVer",{get:function(){return this._data.ver},enumerable:!0,configurable:!0}),e.getDaData=function(){var e=t.Ga.prop(Vt);return e?JSON.parse(e):{ver:"",posList:[],codes:[],policyMap:{},today:0}},e.saveDaData=function(){t.Ga.prop(Vt,JSON.stringify(this._data))},e.getPreloadDA=function(t){return Ft[t.aid]||(Ft[t.aid]={}),Ft[t.aid][t.at]||(Ft[t.aid][t.at]={dc:null}),Ft[t.aid][t.at].dc},e.preloadDA=function(t){Ft[t.aid]||(Ft[t.aid]={}),Ft[t.aid][t.at]||(Ft[t.aid][t.at]={dc:null}),Ft[t.aid][t.at].dc=null;var e;e=this._group<0||this._group>=t.ct.length?0:t.ct[this._group]?this._group:0,Xt.preload(t.aid,t.ct[e],t.at,t.p,function(e){Ft[t.aid][t.at].dc="2"==e?t:null})},e.playDA=function(t,e){var n=this;Ft[t.aid]||(Ft[t.aid]={}),Ft[t.aid][t.at]||(Ft[t.aid][t.at]={dc:null}),Ft[t.aid][t.at].dc=null;var i;i=this._group<0||this._group>=t.ct.length?0:t.ct[this._group]?this._group:0,Xt.play(t.aid,t.ct[i],t.at,t.p,function(i){e(i),2!=t.at&&6!=Number(i)&&n.preloadDA(t)})},e.rstCode=function(){for(var e in t.log("~~ da rstCode"),this._data.policyMap)this._data.policyMap[e].en=!0,this._data.policyMap[e].cc=0,this._data.policyMap[e].crts=0},e.rstCodeIfAllDisable=function(){var t=!0;for(var e in this._data.policyMap)if(this._data.policyMap[e].en){t=!1;break}t&&this.rstCode()},e._getCode=function(t){for(var e=0;e<this._data.codes.length;e++){var n=this._data.codes[e];if(n.cid==t)return n}return null},e.getCurCode=function(e,n,i){var a=this,r=-1;i.length>0&&(r=i[i.length-1]),e.forEach(function(e){var n=a._getCode(e);n.aid==r&&(a._data.policyMap[n.aid].crts>=a._data.policyMap[n.aid].rts?(a._data.policyMap[n.aid].en=!1,t.log("~~ da disable :"+n.aid)):(a._data.policyMap[n.aid].crts++,t.log("~~ da "+n.aid+" crts++:"+a._data.policyMap[n.aid].crts)))});for(var o=0,s=function(t){var n=c._getCode(e[t]),a=c._data.policyMap[n.aid];if(!a.en)return"continue";var r=!1;return i.forEach(function(t){t==n.aid&&(r=!0)}),r?"continue":a.cc<a.c&&a.m&Jt.MODE_COUNT?{value:n}:void(a.m&Jt.MODE_WEIGHT&&(o+=a.w))},c=this,u=0;u<e.length;u++){var d=s(u);if("object"==typeof d)return d.value}var l=Math.random()*o,p=function(t){var n=f._getCode(e[t]),a=f._data.policyMap[n.aid];if(!a.en)return"continue";var r=!1;if(i.forEach(function(t){t==n.aid&&(r=!0)}),r)return"continue";if(a.m&Jt.MODE_WEIGHT){if(l<a.w)return{value:n};l-=a.w}},f=this;for(u=0;u<e.length;u++){var _=p(u);if("object"==typeof _)return _.value}return t.log("~~ da getCurCode:"+JSON.stringify(e)),null},e.selectCode=function(e,n,i){var a=this._data.posList,r=function(){if(!a)return"break";var t,r=Math.floor(Date.now()/864e5);if(o._data.today!=r)for(var s in o._data.today=r,o._data.policyMap)o._data.policyMap[s].en=!0,o._data.policyMap[s].cc=0,o._data.policyMap[s].crts=0,o._data.policyMap[s].tc=0;return a.forEach(function(n){n.p==e&&(t=n.cl)}),t?{value:o.getCurCode(t,n,i)}:"break"},o=this;do{var s=r();if("object"==typeof s)return s.value;if("break"===s)break}while(0);return t.log("~~ da selectCode null:"+e+" codes:"+JSON.stringify(a)+" cfg:"+JSON.stringify(this._data.policyMap)),this.rstCode(),null},e.playDAWithRetry=function(e,n,i,a){var r=this,o={p:0,d:0,s:0,c:0,m:0},s=this.selectCode(e,!1,a);if(s){s.at==Jt.Banner&&0==a.length&&(o.s=Kt.STATUS_OK,i(o));var c=Date.now();this.playBegin(e,n,s,this.getPreloadDA(s),this._data.policyMap[s.aid].tc,a.length,function(u,d){if(u){if(!r._data.policyMap[s.aid])return void(s.at!=Jt.Banner&&(p("!!no policy"),i(o)));r.addCC(s),o.p=d,Date.now(),r.playDA(s,function(u){if(t.log("~~ da r:"+u),o.s=Number(u),o.s==Kt.STATUS_CLICK_AD)o.c++;else{o.d=Date.now()-c;var d=a.length<r._aidCnt;r.playEnd(o,d,function(c){if((o.s==Kt.STATUS_OK||o.s==Kt.STATUS_CANCELED)&&s.at>4){var u=r._data.policyMap[s.aid];u&&u.tc++}switch(c){case 1:a.push(s.aid),t.log("~~ da retry cur_fail:"+s.aid),s.at==Jt.Banner?r.playDAWithRetry(e,n,function(){},a):r.playDAWithRetry(e,n,i,a);break;case 0:o.s!=Kt.STATUS_OK&&(t.log("~~ da r:"+o.s+"->OK"),o.s=Kt.STATUS_OK);case 2:default:s.at!=Jt.Banner&&i(o)}})}})}else o.s=Kt.STATUS_UNKNOWN,s.at!=Jt.Banner&&i(o)})}else o.s=Kt.STATUS_OUT_OF_AD,i(o)},e.addCC=function(t){if(t.at!=Jt.Banner){var e=this._data.policyMap[t.aid];e&&e.cc++,this.saveDaData()}},e.autoPreloadDA=function(){for(var e=this._data.codes,n={},i=0;i<e.length;i++){var a=e[i];switch(n[a.aid]||(n[a.aid]={}),a.at){case Jt.RewardVideo:case Jt.RewardVideoLandscape:n[a.aid].rewardcode||(n[a.aid].rewardcode=a);break;case Jt.FullVideo:case Jt.FullVideoLandscape:n[a.aid].fullcode||(n[a.aid].fullcode=a)}}for(var r in n){var o=n[r];o.rewardcode&&(t.log("~~ da preload reward:"+JSON.stringify(o)),this.preloadDA(o.rewardcode)),o.fullcode&&(t.log("~~ da preload full:"+JSON.stringify(o)),this.preloadDA(o.fullcode))}},e._updateCfg=function(e){if(e.v!=this._data.ver){this._data.ver=e.v,this._data.posList=e.pl,this._data.codes=e.cl;var n=this._data.policyMap;this._data.policyMap={};for(var i=0;i<e.pyl.length;i++){var a=!1,r=e.pyl[i];for(var o in p("~~ da init:"+r.aid),Xt.init(r.aid),n)if(o==""+r.aid){t.log("~~ da pyl:"+r.aid),n[o].aid=r.aid,n[o].m=r.m,n[o].w=r.w,n[o].c=r.c,n[o].rts=r.rts,void 0===n[o].cc&&(n[o].cc=0),void 0===n[o].crts&&(n[o].crts=0),void 0===n[o].en&&(n[o].en=!0),void 0===n[o].tc&&(n[o].tc=0),this._data.policyMap[o]=n[o],a=!0;break}a||(this._data.policyMap[r.aid]?t.log("!! da pyl 2:"+r.aid):(t.log("~~ da pyl 2:"+r.aid),this._data.policyMap[r.aid]=r,this._data.policyMap[r.aid].en=!0,this._data.policyMap[r.aid].cc=0,this._data.policyMap[r.aid].crts=0,this._data.policyMap[r.aid].tc=0))}this.saveDaData()}else for(var o in this._data.policyMap)t.log("~~ da init2:"+o),Xt.init(parseInt(o))},e._parseClientResp=function(t){this._session=t.sid,t.cfg&&this._updateCfg(t.cfg)},Object.defineProperty(e,"daUrl",{get:function(){return"1"==Ct.prop("ga_url_type")?"http://testfsbn.snowfish.cn:9500/das/a/":"https://das-f.appgames.cn:9501/das/a/"},enumerable:!0,configurable:!0}),e.init=function(n){var i=this;for(var a in this._aidCnt=0,this._data=this.getDaData(),this._data.policyMap)this._aidCnt++;var r={sid:this._session,pg:t.Ga.prop("sys.pkgName"),pv:t.Ga.prop("sys.verName"),ch:t.Ga.prop("sys.channel"),d:t.Ga.prop(t.PROP_DEVICE_ID),pu:t.Ga.prop("umdeviceToken"),vnd:t.Ga.prop("sys.build.brand"),bm:t.Ga.prop("sys.build.model"),bv:t.Ga.prop("sys.build.sdkInt"),ov:t.Ga.prop("sys.build.osVer"),if:t.Ga.prop("sys.prop.idfa"),ot:parseInt(t.Ga.prop(t.PROP_PLATFORM)),dv:1,sv:t.Ga.prop("sys.verCode"),al:JSON.parse(t.Ga.prop(j)),u:this.userToken,lcv:this.cfgVer};for(var o in r)null===r[o]&&(r[o]=void 0);p(this.daUrl+"i/ ->:"+JSON.stringify(r)),this._initing=!0,t.XMLHttp.postJSONEx(this.daUrl+"i/",!1,JSON.stringify(r),function(t,a,r){i._initing=!1,p("http <-:"+JSON.stringify(a)),a&&"OK"==a.r?(i._inited=!0,i._parseClientResp(a),i._group=a.ag,e.autoPreloadDA(),i.userToken=a.u,n&&n(!0)):n&&n(!1)},15e3)},e.play=function(e,n,i){this._initing?i({p:0,d:0,c:0,m:0,s:qt.BusyInit}):this._inited?"1"==t.Ga.prop("prop.noDA")?i({p:0,d:0,c:0,m:0,s:qt.Unknown}):(this.rstCodeIfAllDisable(),this.playDAWithRetry(e,n,i,[])):i({p:0,d:0,c:0,m:0,s:qt.BusyInit})},e.hideBa=function(){Xt.closePlay()},e.playBegin=function(e,n,i,a,r,o,s){var c,u=this,d=a||i;c=this._group<0||this._group>=d.ct.length?0:d.ct[this._group]?this._group:0;var l={sid:this._session,pp:e,rt:o,ct:Date.now(),as:i.aid,ac:i.cid,pas:d.aid,pac:d.cid,pat:d.at,pak:d.ct[c],pag:this._group,f:a?1:0,g:Mt.id,up:n,gu:Mt.isSingle?void 0:Mt.prop(t.PROP_UID)};p(this.daUrl+"b/ ->:"+JSON.stringify(l)),t.XMLHttp.postJSONEx(this.daUrl+"b/",!1,JSON.stringify(l),function(t,e,n){p("http <-:"+JSON.stringify(e)),e&&"OK"==e.r?(u._parseClientResp(e),u._group=e.ag,s(!0,e.p)):s(!1,0)},15e3)},e.playEnd=function(e,n,i){var a=this,r={sid:this._session,p:e.p,d:e.d,s:e.s,c:e.c,m:e.m};p(this.daUrl+"e/ ->:"+JSON.stringify(r)),t.XMLHttp.postJSONEx(this.daUrl+"e/",!1,JSON.stringify(r),function(t,n,r){p("http <-:"+JSON.stringify(n)),n&&"OK"==n.r?(a._parseClientResp(n),i(n.s)):i(e.s)},15e3)},e._aidCnt=0,e._initing=!1,e._inited=!1,e._group=0,e}();__reflect(Wt.prototype,"DaManager");var qt,Qt,Xt=function(){function t(){}return t.init=function(t){Ct.prop("cmd.initadsdk",""+t)},t.preload=function(t,e,n,i,a){Ct.invoke("D",K,[u(K+e,a,!0),t,e,n,i])},t.play=function(t,e,n,i,a){Ct.invoke("D",W,[u(W+e,a,!1),t,e,n,i])},t.closePlay=function(){Ct.invoke("D","daClosePlay")},t}();__reflect(Xt.prototype,"_ShellDA"),function(t){t[t.BusyInit=-3]="BusyInit",t[t.NoInit=-2]="NoInit",t[t.InitFail=-1]="InitFail",t[t.Unknown=0]="Unknown",t[t.Success=2]="Success",t[t.Canceled=3]="Canceled",t[t.OutOfAD=4]="OutOfAD",t[t.TimeOut=5]="TimeOut"}(qt=t.ADResult||(t.ADResult={})),function(t){t[t.FullVideoPortrait=1]="FullVideoPortrait",t[t.FullVideoLandscape=2]="FullVideoLandscape",t[t.RewardVideoPortrait=3]="RewardVideoPortrait",t[t.RewardVideoLandscape=4]="RewardVideoLandscape",t[t.BaTop=5]="BaTop",t[t.BaBottom=6]="BaBottom"}(Qt=t.EPosID||(t.EPosID={}))}($SF||($SF={}));